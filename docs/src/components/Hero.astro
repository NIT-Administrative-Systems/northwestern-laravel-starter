---
import { Image } from "astro:assets";
import { LinkButton } from "@astrojs/starlight/components";

const PAGE_TITLE_ID = "_top";
const { data } = Astro.locals.starlightRoute.entry;
const { title = data.title, tagline, image, actions = [] } = data.hero || {};

const imageAttrs = {
    loading: "eager" as const,
    decoding: "async" as const,
    width: 750,
    height: 250,
    alt: image?.alt || "",
};

let darkImage: ImageMetadata | undefined;
let lightImage: ImageMetadata | undefined;
let rawHtml: string | undefined;
if (image) {
    if ("file" in image) {
        darkImage = image.file;
    } else if ("dark" in image) {
        darkImage = image.dark;
        lightImage = image.light;
    } else {
        rawHtml = image.html;
    }
}
---

<div class="hero">
    <div class="sl-flex stack">
        {
            darkImage && (
                <Image
                    src={darkImage}
                    {...imageAttrs}
                    class:list={[
                        "hero-image",
                        { "light:sl-hidden": Boolean(lightImage) },
                    ]}
                />
            )
        }
        {
            lightImage && (
                <Image
                    src={lightImage}
                    {...imageAttrs}
                    class="hero-image dark:sl-hidden"
                />
            )
        }
        {rawHtml && <div class="hero-html sl-flex" set:html={rawHtml} />}

        <div class="sl-flex copy">
            <!-- Only show title if explicitly set in hero config (not defaulting to page title) -->
            {
                data.hero?.title && (
                    <h1 id={PAGE_TITLE_ID} data-page-title set:html={title} />
                )
            }
            {tagline && <div class="tagline" set:html={tagline} />}
        </div>

        {
            actions.length > 0 && (
                <div class="sl-flex actions">
                    {actions.map(({ icon, link: href, text, variant }) => (
                        <LinkButton
                            href={href}
                            variant={variant}
                            icon={icon?.name || icon}
                        >
                            {text}
                        </LinkButton>
                    ))}
                </div>
            )
        }
    </div>
</div>

<style>
    .hero {
        display: flex;
        align-items: center;
        justify-content: center;
        padding-block: clamp(2rem, calc(1rem + 10vmin), 8rem);
    }

    .hero-image,
    .hero-html {
        object-fit: contain;
        width: min(90%, 1000px);
        height: auto;
        margin-inline: auto;
    }

    .stack {
        flex-direction: column;
        gap: clamp(1.5rem, calc(1.5rem + 1vw), 2.5rem);
        text-align: center;
        align-items: center;
    }

    .copy {
        flex-direction: column;
        gap: 1rem;
        align-items: center;
    }

    .copy > * {
        max-width: 50ch;
    }

    h1 {
        font-size: clamp(
            var(--sl-text-3xl),
            calc(0.25rem + 5vw),
            var(--sl-text-6xl)
        );
        line-height: var(--sl-line-height-headings);
        font-weight: 600;
        color: var(--sl-color-white);
    }

    .tagline {
        font-size: clamp(
            var(--sl-text-base),
            calc(0.0625rem + 1.5vw),
            var(--sl-text-lg)
        );
        color: var(--sl-color-gray-2);
        max-width: 90vw;
    }

    .actions {
        gap: 1rem;
        flex-direction: column;
        align-items: stretch;
        width: 100%;
        max-width: 300px;
    }

    .actions :global(a) {
        width: 100%;
        justify-content: center;
    }

    @media (min-width: 50rem) {
        .tagline {
            white-space: nowrap;
            max-width: none;
        }

        .actions {
            flex-direction: row;
            align-items: center;
            width: auto;
            max-width: none;
        }

        .actions :global(a) {
            width: auto;
        }
    }
</style>
